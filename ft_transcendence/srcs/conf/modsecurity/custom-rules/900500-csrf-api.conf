# These rules block POST/PUT/PATCH/DELETE to /api/ (except login/register/logout/upload/csrf-token) if X-CSRF-Token is missing.
# NOTE: disruptive action (deny) must be on the chain starter.
SecRule REQUEST_METHOD "@rx ^(?:POST|PUT|PATCH|DELETE)$" "id:900500,phase:2,deny,status:403,log,msg:'CSRF token missing: method matches',t:none,chain"
SecRule REQUEST_URI "@beginsWith /api/" "t:none,chain"
SecRule REQUEST_URI "!@rx ^/api(?:/auth)?/(?:login|register|logout|csrf-token)$" "t:none,chain"
SecRule REQUEST_URI "!@streq /api/upload" "t:none,chain"
SecRule &REQUEST_HEADERS:X-CSRF-Token "@eq 0" "t:none"