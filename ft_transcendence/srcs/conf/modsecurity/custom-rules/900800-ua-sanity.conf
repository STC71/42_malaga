# This rule blocks requests that do not include a User-Agent header.
# It helps prevent automated or suspicious requests that often omit this header.
SecRule &REQUEST_HEADERS:User-Agent "@eq 0" "id:900800,phase:1,deny,status:400,log,msg:'Missing User-Agent header',chain,t:none"
SecRule TX:ua_required "@eq 1" "t:none"

# This rule blocks requests that attempt SSRF to private, localhost, or metadata IPs.
# The list of private IPs is defined in crs-setup.conf as tx.private_ip_regex.
SecRule ARGS|REQUEST_HEADERS|REQUEST_URI "@rx %{tx.private_ip_regex}" \
    "id:900809,phase:2,deny,status:403,log,msg:'SSRF attempt to private/internal IP detected',t:none"

# This rule blocks requests containing suspicious URL schemes (SSRF/LFI gadgets).
# The list of bad schemes is defined in crs-setup.conf as tx.bad_schemes.
SecRule ARGS|REQUEST_HEADERS|REQUEST_URI "@rx (?i)(?:%{tx.bad_schemes}):" \
    "id:900810,phase:2,deny,status:403,log,msg:'Suspicious URL scheme detected (SSRF/LFI attempt)',t:none"
    
# This rule blocks requests attempting to access sensitive LFI target paths.
# The list of LFI paths is defined in crs-setup.conf as tx.lfi_paths.
SecRule ARGS|REQUEST_HEADERS|REQUEST_URI "@rx (?i)%{tx.lfi_paths}" \
    "id:900820,phase:2,deny,status:403,log,msg:'LFI target path detected',t:none"
