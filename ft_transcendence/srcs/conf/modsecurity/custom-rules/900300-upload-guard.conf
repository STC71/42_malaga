# This rule blocks requests to /api/upload unless Content-Type is multipart/form-data.
# It enforces that only standard file uploads are accepted.
SecRule REQUEST_URI "@rx ^/api/upload" "id:900302,phase:1,deny,status:415,log,t:none,msg:'Only multipart or allowed content-types in /api/upload',chain"
# Explicitly accept common POST content-types here so urlencoded form posts can reach phase:2
SecRule REQUEST_HEADERS:Content-Type "!@rx ^(?:multipart/form-data|application/x-www-form-urlencoded|application/json)(?:;|$)" "t:none"

# This rule blocks requests to /api/upload with a body larger than tx.upload_max_size.
# It helps prevent abuse and denial of service via large uploads.
SecRule REQUEST_URI "@rx ^/api/upload" "id:900303,phase:2,deny,status:413,log,t:none,msg:'Upload too large in /api/upload',chain"
SecRule REQUEST_BODY_LENGTH "@gt %{tx.upload_max_size}" "t:none"
